---
layout: default
title: Устранение неполадок
nav_order: 5
---

# Устранение неполадок

Эта страница предоставляет решения для распространенных проблем, которые могут возникнуть при использовании SmartRAG.

## Проблемы конфигурации

### Настройка API-ключей

**Проблема**: Ошибки аутентификации с AI или провайдерами хранилищ.

**Решение**: Убедитесь, что ваши API-ключи правильно настроены в `appsettings.json`:

```json
{
  "SmartRAG": {
    "AIProvider": "Anthropic",
    "StorageProvider": "Qdrant",
    "MaxChunkSize": 1000,
    "ChunkOverlap": 200
  },
  "Anthropic": {
    "ApiKey": "your-anthropic-api-key"
  },
  "Qdrant": {
    "ApiKey": "your-qdrant-api-key"
  }
}
```

Или установите переменные окружения:

```bash
# Установите переменные окружения
export ANTHROPIC_API_KEY=your-anthropic-api-key
export QDRANT_API_KEY=your-qdrant-api-key
```

### Проблемы регистрации сервисов

**Проблема**: Ошибки внедрения зависимостей.

**Решение**: Убедитесь, что сервисы SmartRAG правильно зарегистрированы в вашем `Program.cs`:

```csharp
using SmartRAG.Extensions;

var builder = WebApplication.CreateBuilder(args);

// Добавьте сервисы SmartRAG
builder.Services.AddSmartRag(builder.Configuration);

var app = builder.Build();
app.UseSmartRag(builder.Configuration, StorageProvider.Qdrant, AIProvider.Anthropic);
app.Run();
```

## Проблемы загрузки документов

### Ограничения размера файлов

**Проблема**: Большие документы не загружаются или не обрабатываются.

**Решение**: 
- Проверьте ограничения размера файлов вашего приложения в `appsettings.json`
- Рассмотрите возможность разделения больших документов на меньшие части
- Убедитесь, что достаточно памяти для обработки

### Неподдерживаемые типы файлов

**Проблема**: Ошибки для определенных форматов файлов.

**Решение**: SmartRAG поддерживает распространенные текстовые форматы. Убедитесь, что ваши файлы в поддерживаемых форматах:
- PDF файлы
- Текстовые файлы (.txt)
- Документы Word (.docx)
- Markdown файлы (.md)

## Проблемы поиска и извлечения

### Нет результатов поиска

**Проблема**: Поисковые запросы не возвращают результатов.

**Возможные решения**:
1. **Проверьте загрузку документов**: Убедитесь, что документы были успешно загружены
2. **Проверьте эмбеддинги**: Убедитесь, что эмбеддинги были правильно сгенерированы
3. **Специфичность запроса**: Попробуйте более специфичные поисковые термины
4. **Соединение с хранилищем**: Убедитесь, что ваш провайдер хранилища доступен

### Плохое качество поиска

**Проблема**: Результаты поиска не релевантны.

**Решения**:
- Настройте параметры `MaxChunkSize` и `ChunkOverlap`
- Используйте более специфичные поисковые запросы
- Убедитесь, что документы правильно отформатированы
- Проверьте, актуальны ли эмбеддинги

## Проблемы производительности

### Медленная обработка документов

**Проблема**: Загрузка и обработка документов занимает слишком много времени.

**Решения**:
- Увеличьте `MaxChunkSize`, чтобы уменьшить количество чанков
- Используйте более мощного AI-провайдера
- Оптимизируйте конфигурацию вашего провайдера хранилища
- Рассмотрите использование асинхронных операций в вашем приложении

### Проблемы с памятью

**Проблема**: Приложение исчерпывает память во время обработки.

**Решения**:
- Уменьшите `MaxChunkSize`, чтобы создать меньшие чанки
- Обрабатывайте документы пакетами
- Отслеживайте использование памяти и оптимизируйте соответственно
- Рассмотрите использование потоковых операций для больших файлов

## Проблемы провайдеров хранилищ

### Проблемы соединения с Qdrant

**Проблема**: Не удается подключиться к Qdrant.

**Решения**:
- Убедитесь, что API-ключ Qdrant правильный
- Проверьте сетевое соединение с сервисом Qdrant
- Убедитесь, что сервис Qdrant запущен и доступен
- Проверьте настройки брандмауэра

### Проблемы соединения с Redis

**Проблема**: Не удается подключиться к Redis.

**Решения**:
- Проверьте строку соединения Redis
- Убедитесь, что сервер Redis запущен
- Проверьте сетевое соединение
- Проверьте конфигурацию Redis в `appsettings.json`

### Проблемы с SQLite

**Проблема**: Ошибки базы данных SQLite.

**Решения**:
- Проверьте права доступа к файлам для каталога базы данных
- Убедитесь, что достаточно места на диске
- Проверьте правильность пути к файлу базы данных
- Проверьте на повреждение базы данных

## Проблемы AI-провайдеров

### Ошибки API Anthropic

**Проблема**: Ошибки от API Anthropic.

**Решения**:
- Убедитесь, что API-ключ действителен и имеет достаточно кредитов
- Проверьте лимиты скорости API
- Убедитесь в правильной конфигурации конечной точки API
- Отслеживайте использование API и квоты

### Ошибки API OpenAI

**Проблема**: Ошибки от API OpenAI.

**Решения**:
- Убедитесь, что API-ключ действителен
- Проверьте лимиты скорости API и квоты
- Убедитесь в правильной конфигурации модели
- Отслеживайте использование API

## Тестирование и отладка

### Модульные тесты

**Проблема**: Тесты не проходят из-за зависимостей SmartRAG.

**Решение**: Используйте мокирование для сервисов SmartRAG в модульных тестах:

```csharp
[Test]
public async Task TestDocumentUpload()
{
    // Arrange
    var mockDocumentService = new Mock<IDocumentService>();
    var mockSearchService = new Mock<IDocumentSearchService>();
    
    var controller = new DocumentsController(
        mockDocumentService.Object, 
        mockSearchService.Object, 
        Mock.Of<ILogger<DocumentsController>>());

    // Act & Assert
    // Ваша логика теста здесь
}
```

### Интеграционные тесты

**Проблема**: Интеграционные тесты не проходят.

**Решение**: Используйте тестовую конфигурацию и убедитесь в правильной настройке:

```csharp
[Test]
public async Task TestEndToEndWorkflow()
{
    // Arrange
    var configuration = new ConfigurationBuilder()
        .SetBasePath(Directory.GetCurrentDirectory())
        .AddJsonFile("appsettings.test.json", optional: true)
        .AddEnvironmentVariables()
        .Build();

    var services = new ServiceCollection();
    services.AddSmartRag(configuration);
    
    var serviceProvider = services.BuildServiceProvider();
    
    // Act & Assert
    // Ваша логика интеграционного теста здесь
}
```

## Распространенные сообщения об ошибках

### "Document not found"
- Убедитесь, что ID документа правильный
- Проверьте, был ли документ успешно загружен
- Убедитесь, что документ не был удален

### "Storage provider not configured"
- Проверьте настройку `StorageProvider` в конфигурации
- Убедитесь, что предоставлены все необходимые настройки хранилища
- Проверьте регистрацию сервиса

### "AI provider not configured"
- Проверьте настройку `AIProvider` в конфигурации
- Убедитесь, что предоставлен API-ключ для выбранного провайдера
- Проверьте регистрацию сервиса

### "Invalid file format"
- Убедитесь, что файл в поддерживаемом формате
- Проверьте расширение файла и содержимое
- Убедитесь, что файл не поврежден

## Получение помощи

Если у вас все еще есть проблемы:

1. **Проверьте логи**: Просмотрите логи приложения для подробных сообщений об ошибках
2. **Проверьте конфигурацию**: Дважды проверьте все настройки конфигурации
3. **Протестируйте с минимальной настройкой**: Попробуйте сначала с простой конфигурацией
4. **Проверьте зависимости**: Убедитесь, что все необходимые сервисы запущены
5. **Просмотрите документацию**: Проверьте другие страницы документации для руководства

Для дополнительной поддержки обратитесь к GitHub-репозиторию проекта или создайте issue с подробной информацией о вашей проблеме.
